<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PCIeMini_CAN_FD: PcieCra Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PCIeMini_CAN_FD
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="class_pcie_cra-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">PcieCra Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>PCIe CRA module controller class.  
 <a href="class_pcie_cra.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="_pcie_cra_8h_source.html">PcieCra.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a61122428d2a4b2cb6e20a3153394d200"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_pcie_cra.html#a61122428d2a4b2cb6e20a3153394d200">PcieCra</a> (volatile void *cra_addr)</td></tr>
<tr class="memdesc:a61122428d2a4b2cb6e20a3153394d200"><td class="mdescLeft">&#160;</td><td class="mdescRight">constructor  <a href="class_pcie_cra.html#a61122428d2a4b2cb6e20a3153394d200">More...</a><br /></td></tr>
<tr class="separator:a61122428d2a4b2cb6e20a3153394d200"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a9a379b59b519a163e241e4beb0fb7b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_pcie_cra.html#a5a9a379b59b519a163e241e4beb0fb7b">reset</a> ()</td></tr>
<tr class="memdesc:a5a9a379b59b519a163e241e4beb0fb7b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset the CRA PCIe interface.  <a href="class_pcie_cra.html#a5a9a379b59b519a163e241e4beb0fb7b">More...</a><br /></td></tr>
<tr class="separator:a5a9a379b59b519a163e241e4beb0fb7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a69d2257d147719270388e0bdc02f4b"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_pcie_cra.html#a0a69d2257d147719270388e0bdc02f4b">getIrqStatus</a> ()</td></tr>
<tr class="memdesc:a0a69d2257d147719270388e0bdc02f4b"><td class="mdescLeft">&#160;</td><td class="mdescRight">return the interrupt status of the local IRQ lines  <a href="class_pcie_cra.html#a0a69d2257d147719270388e0bdc02f4b">More...</a><br /></td></tr>
<tr class="separator:a0a69d2257d147719270388e0bdc02f4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e3aac8849a818c5a739fd31eb137784"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_pcie_cra.html#a1e3aac8849a818c5a739fd31eb137784">setIrqEnableMask</a> (uint32_t mask)</td></tr>
<tr class="memdesc:a1e3aac8849a818c5a739fd31eb137784"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enable/disable the interrupts.  <a href="class_pcie_cra.html#a1e3aac8849a818c5a739fd31eb137784">More...</a><br /></td></tr>
<tr class="separator:a1e3aac8849a818c5a739fd31eb137784"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5498fc3cc0a8797f9b96f631d17c5dd4"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_pcie_cra.html#a5498fc3cc0a8797f9b96f631d17c5dd4">getIrqEnableMask</a> ()</td></tr>
<tr class="memdesc:a5498fc3cc0a8797f9b96f631d17c5dd4"><td class="mdescLeft">&#160;</td><td class="mdescRight">return the interrupt enable mask  <a href="class_pcie_cra.html#a5498fc3cc0a8797f9b96f631d17c5dd4">More...</a><br /></td></tr>
<tr class="separator:a5498fc3cc0a8797f9b96f631d17c5dd4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7624aa5dc82acb4e3eb2ee1beaa0daf3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_alphi_error_codes_8h.html#a4b142a4c78e96bfd701721b08ab3dfd3">PCIeMini_status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_pcie_cra.html#a7624aa5dc82acb4e3eb2ee1beaa0daf3">setTxsAvlAddress</a> (uint32_t txs_addr, uint64_t pageSize, uint16_t nbrOfEntries)</td></tr>
<tr class="memdesc:a7624aa5dc82acb4e3eb2ee1beaa0daf3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the local Avalon address for the PCIe txs port.  <a href="class_pcie_cra.html#a7624aa5dc82acb4e3eb2ee1beaa0daf3">More...</a><br /></td></tr>
<tr class="separator:a7624aa5dc82acb4e3eb2ee1beaa0daf3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7c62181fcbf19e128fe777bf9f3f52e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="_alphi_error_codes_8h.html#a4b142a4c78e96bfd701721b08ab3dfd3">PCIeMini_status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_pcie_cra.html#ab7c62181fcbf19e128fe777bf9f3f52e">getMappedAddress</a> (uint64_t pcieAddress, int tableEntry, uint32_t *localAddress)</td></tr>
<tr class="memdesc:ab7c62181fcbf19e128fe777bf9f3f52e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the DMA address through the txs.  <a href="class_pcie_cra.html#ab7c62181fcbf19e128fe777bf9f3f52e">More...</a><br /></td></tr>
<tr class="separator:ab7c62181fcbf19e128fe777bf9f3f52e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3906bcddc5af9e57bf35d2f8609969b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_pcie_cra.html#ad3906bcddc5af9e57bf35d2f8609969b">setTrEntry</a> (int entryNbr, bool is64bitAddress, uint64_t pcieAddress)</td></tr>
<tr class="memdesc:ad3906bcddc5af9e57bf35d2f8609969b"><td class="mdescLeft">&#160;</td><td class="mdescRight">program an entry in the translation table  <a href="class_pcie_cra.html#ad3906bcddc5af9e57bf35d2f8609969b">More...</a><br /></td></tr>
<tr class="separator:ad3906bcddc5af9e57bf35d2f8609969b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>PCIe CRA module controller class. </p>
<p>This is a limited software interface to the CRA module of the PCIe adapter that:</p><ul>
<li>allows to enable/disable the interrupt requests to the PCIe bus and check the status of the local interrupt request lines.</li>
<li>allows some DMA to/from the PC</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">txs_addr</td><td>Address of the txs interface of the PCIe interface chip, in the Avalon address space. It is used to program the DMA controller. </td></tr>
  </table>
  </dd>
</dl>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a61122428d2a4b2cb6e20a3153394d200"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61122428d2a4b2cb6e20a3153394d200">&#9670;&nbsp;</a></span>PcieCra()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PcieCra::PcieCra </td>
          <td>(</td>
          <td class="paramtype">volatile void *&#160;</td>
          <td class="paramname"><em>cra_addr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>constructor </p>
<p>This constructor should be only called when the board is opened.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cra_addr</td><td>Address of the CRA in user space. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a5498fc3cc0a8797f9b96f631d17c5dd4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5498fc3cc0a8797f9b96f631d17c5dd4">&#9670;&nbsp;</a></span>getIrqEnableMask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t PcieCra::getIrqEnableMask </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>return the interrupt enable mask </p>

</div>
</div>
<a id="a0a69d2257d147719270388e0bdc02f4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a69d2257d147719270388e0bdc02f4b">&#9670;&nbsp;</a></span>getIrqStatus()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t PcieCra::getIrqStatus </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>return the interrupt status of the local IRQ lines </p>
<p>In order for the PCIe interface to request an interrupt on the PCIe bus, the bit needs to be set in this register, and the corresponding bit should be set in the interrupt mask register. </p>

</div>
</div>
<a id="ab7c62181fcbf19e128fe777bf9f3f52e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab7c62181fcbf19e128fe777bf9f3f52e">&#9670;&nbsp;</a></span>getMappedAddress()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_alphi_error_codes_8h.html#a4b142a4c78e96bfd701721b08ab3dfd3">PCIeMini_status</a> PcieCra::getMappedAddress </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>pcieAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tableEntry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>localAddress</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate the DMA address through the txs. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pcieAddress</td><td>PCIe address of the PC memory </td></tr>
    <tr><td class="paramname">tableEntry</td><td>entry number in the translation table </td></tr>
    <tr><td class="paramname">localAddress</td><td>Address to program in the DMA to access the txs port of the PCIe controller </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a5a9a379b59b519a163e241e4beb0fb7b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a9a379b59b519a163e241e4beb0fb7b">&#9670;&nbsp;</a></span>reset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PcieCra::reset </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset the CRA PCIe interface. </p>
<p>Disable interrupts. </p>

</div>
</div>
<a id="a1e3aac8849a818c5a739fd31eb137784"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e3aac8849a818c5a739fd31eb137784">&#9670;&nbsp;</a></span>setIrqEnableMask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PcieCra::setIrqEnableMask </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>mask</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enable/disable the interrupts. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mask</td><td>bit mask of enabled interrupts </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ad3906bcddc5af9e57bf35d2f8609969b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad3906bcddc5af9e57bf35d2f8609969b">&#9670;&nbsp;</a></span>setTrEntry()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int PcieCra::setTrEntry </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>entryNbr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>is64bitAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>pcieAddress</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>program an entry in the translation table </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">entryNbr</td><td>Index of the entry to set up. </td></tr>
    <tr><td class="paramname">is64bitAddress</td><td>True if the address of the target location is a 64-bit address </td></tr>
    <tr><td class="paramname">pcieAddress</td><td>Address of the target location </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a7624aa5dc82acb4e3eb2ee1beaa0daf3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7624aa5dc82acb4e3eb2ee1beaa0daf3">&#9670;&nbsp;</a></span>setTxsAvlAddress()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_alphi_error_codes_8h.html#a4b142a4c78e96bfd701721b08ab3dfd3">PCIeMini_status</a> PcieCra::setTxsAvlAddress </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>txs_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>pageSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>nbrOfEntries</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the local Avalon address for the PCIe txs port. </p>
<p>For example, if the core is configured with an address translation table with the following attributes :</p><ul>
<li>Number of Address Pages—16<ul>
<li>Size of Address Pages—1 MByte</li>
<li>PCI Express Address Size—64 bits then the values in Figure 4–12 are :</li>
</ul>
</li>
<li>N = 20 (due to the 1 MByte page size)<ul>
<li>Q = 16 (number of pages)</li>
<li>M = 24 (20 + 4 bit page selection)</li>
<li>P = 64 In this case, the Avalon address is interpreted as follows :</li>
</ul>
</li>
<li>Bits[31:24] select the TX slave module port from among other slaves connected to the same master by the system interconnect fabric.The decode is based on the base addresses assigned in Qsys.<ul>
<li>Bits[23:20] select the address translation table entry.</li>
<li>Bits[63:20] of the address translation table entry become PCI Express address bits [63:20].</li>
<li>Bits[19:0] are passed throughand become PCI Express address bits[19:0]. The address translation table can be hardwired or dynamically configured at run time.When the IP core is parameterized for dynamic address translation, the address translation table is implemented in memoryand can be accessed through the CRA slave module.This access mode is useful in a typical PCI Express system where address allocation occurs after BIOS initialization.</li>
<li>Number of Address Pages—2</li>
<li>Size of Address Pages—16 MByte</li>
<li>PCI Express Address Size—64 bits then the values in Figure 4–12 are :</li>
</ul>
</li>
<li>N = 24 (due to the 16 MByte page size)<ul>
<li>Q = 2 (number of pages)</li>
<li>M = 25 (24 + 1 bit page selection)</li>
<li>P = 64 In this case, the Avalon address is interpreted as follows :</li>
</ul>
</li>
<li>Bits[31:24] select the TX slave module port from among other slaves connected to the same master by the system interconnect fabric.The decode is based on the base addresses assigned in Qsys.<ul>
<li>Bits[24] select the address translation table entry.</li>
<li>Bits[63:25] of the address translation table entry become PCI Express address bits [63:20].</li>
<li>Bits[23:0] are passed throughand become PCI Express address bits[19:0]. The address translation table can be hardwired or dynamically configured at run time.When the IP core is parameterized for dynamic address translation, the address translation table is implemented in memoryand can be accessed through the CRA slave module.This access mode is useful in a typical PCI Express system where address allocation occurs after BIOS initialization.</li>
</ul>
</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">txs_addr</td><td>Local Avalon Address of the txs area </td></tr>
    <tr><td class="paramname">nbrOfEntries</td><td>Number of table entries used to calculate the bit pattern </td></tr>
    <tr><td class="paramname">pageSize</td><td>size of each translation page (this is currently ignored, hard coded) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>C:/Alphi/PCIeMiniSoftware/include/<a class="el" href="_pcie_cra_8h_source.html">PcieCra.h</a></li>
<li>C:/Alphi/PCIeMiniSoftware/PCIeMini_lib/<a class="el" href="_pcie_cra_8cpp.html">PcieCra.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>
